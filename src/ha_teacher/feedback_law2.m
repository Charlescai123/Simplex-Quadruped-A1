function [F_kp, F_kd] = feedback_law2(roll, pitch, yaw)

Rx = [1          0           0;
      0  cos(roll)  -sin(roll);
      0  sin(roll)   cos(roll)];

Ry = [cos(pitch)  0  sin(pitch);
           0      1       0;
      -sin(pitch) 0  cos(pitch)];

Rz = [cos(yaw)   -sin(yaw)   0;
      sin(yaw)    cos(yaw)   0;
             0           0   1];

Rzyx = Rz * Ry * Rx;

T = 1/35;  %sampling period

C = [1, 0, 0];


%%%%Contiunous matrices%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
aA = [zeros(1,1),  zeros(1,3),           C,    zeros(1,3);
      zeros(3,1),  zeros(3,3),    zeros(3,3),    Rzyx;
      zeros(3,1),  zeros(3,3),    zeros(3,3),    zeros(3,3);
      zeros(3,1),  zeros(3,3),    zeros(3,3),    zeros(3,3)];
aB = [zeros(4,6);
         eye(6)];
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%Discrete-time%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
B = [zeros(4,6);
         eye(6)]*T;
A = eye(10) + T*aA;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


bP = [122.164786064669,-3.89050081539685e-14,-1.71206279374688e-14,-7.37784179765556e-12,2.48716597374493,-2.95402935890359e-14,1.27301538061969e-13,-1.70766605125324e-14,-1.29915384821969e-14,-6.98606115455056e-12;
-3.89050081539685e-14,1.47354080891556e-06,1.55663100028071e-14,-8.75169195059441e-15,-2.66071135381895e-14,6.45700845017122e-15,-1.89601619017399e-14,9.2677195456333e-07,7.78631509136311e-15,-5.39170655062194e-15;
-1.71206279374688e-14,1.55663100028071e-14,1.47932354973524e-06,-3.31707417284162e-15,-1.67471019065798e-14,-7.83719972944812e-15,-1.13407537602767e-14,8.70497029412245e-15,9.32488033811975e-07,-5.18019305425273e-15;
-7.37784179765556e-12,-8.75169195059441e-15,-3.31707417284162e-15,480.62107526958,2.74035576984513e-13,-2.60967640240079e-15,1.22295278027763e-14,-4.63913639636626e-15,-2.43247120773353e-15,155.295455907449;
2.48716597374493,-2.66071135381895e-14,-1.67471019065798e-14,2.74035576984513e-13,3.21760325418695,-1.73243748868358e-14,4.84581378512941e-14,-1.80360633131375e-14,-1.12276544869069e-14,7.60220339635837e-14;
-2.95402935890359e-14,6.45700845017122e-15,-7.83719972944812e-15,-2.60967640240079e-15,-1.73243748868358e-14,1.28169690018047e-06,4.28374724057626e-14,1.92878470527098e-15,-4.42357798623847e-15,7.80802337084638e-16;
1.27301538061969e-13,-1.89601619017399e-14,-1.13407537602767e-14,1.22295278027763e-14,4.84581378512941e-14,4.28374724057626e-14,1.20613921073601e-06,-1.49640835419355e-14,-6.55697894841647e-15,8.91876761989601e-15;
-1.70766605125324e-14,9.2677195456333e-07,8.70497029412245e-15,-4.63913639636626e-15,-1.80360633131375e-14,1.92878470527098e-15,-1.49640835419355e-14,6.75277385065889e-07,7.07873672874116e-15,-3.84801169536018e-15;
-1.29915384821969e-14,7.78631509136311e-15,9.32488033811975e-07,-2.43247120773353e-15,-1.12276544869069e-14,-4.42357798623847e-15,-6.55697894841647e-15,7.07873672874116e-15,6.77944945905961e-07,-3.06709563794899e-15;
-6.98606115455056e-12,-5.39170655062194e-15,-5.18019305425273e-15,155.295455907449,7.60220339635837e-14,7.80802337084638e-16,8.91876761989601e-15,-3.84801169536018e-15,-3.06709563794899e-15,156.306807893237];

eta = 2;
beta = 1;
kappa = 0.001;

setlmis([]) 
Q = lmivar(1,[10 1]); 
R = lmivar(2,[6 10]); 

lmiterm([-1 1 1 Q],1,(beta - 2*eta*kappa)*eye(10));
lmiterm([-1 2 1 Q],A,1);
lmiterm([-1 2 1 R],B,1);
lmiterm([-1 2 2 Q],1,0.95);

lmiterm([2 1 1 Q], eye(10), bP);
lmiterm([2 1 1 0], -eye(10));

%lmiterm([3 1 1 Q], -1*eta*eye(10), bP);
%lmiterm([3 1 1 0], eye(10));

mylmi = getlmis;


[tmin, psol] = feasp(mylmi);

assert(tmin < 0)

Q = dec2mat(mylmi, psol, Q);
R = dec2mat(mylmi, psol, R);

P = inv(Q);

aF = round(aB*R*P,0);

Fb1 = [0 0 0;
       0 0 0;
       0 0 aF(5,1)];
Fb2 = aF(8:10,2:4);


F_kp = -[Fb1, zeros(3,3);
      zeros(3,3), Fb2]

F_kd = -aF(5:10,5:10)

end


